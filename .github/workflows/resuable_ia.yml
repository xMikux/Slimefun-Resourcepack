name: Makeup IA Resourcepack

on:
  workflow_call:
    secrets:
      RCON_PASSWORD:
        required: true
      S3_ACCESS_KEY:
        required: true
      S3_SECRET_KEY:
        required: true
      S3_BUCKET_NAME:
        required: true

jobs:
  ia_resourcepack:
    name: Generate IA Resourcepack
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # - name: Setup - S3cmd Cli Tool
      #   uses: s3-actions/s3cmd@v1.7.0
      #   with:
      #     provider: "vultr"
      #     region: "sgp1"
      #     access_key: ${{ secrets.S3_ACCESS_KEY }}
      #     secret_key: ${{ secrets.S3_SECRET_KEY }}

      # - name: S3 - Download Plugins
      #   run: |
      #     s3cmd get s3://${{ secrets.S3_BUCKET_NAME }}/itemsaddres maps-cache-data.tar.xz

      - name: Setup - IA Minecraft Server
        run: |
          mkdir output
          docker compose -f .github/compose/docker-compose.yml up
        env:
          RCON_ENV: ${{ secrets.RCON_PASSWORD }}

      - name: Health - Check server is online
        uses: raschmitt/wait-for-healthy-container/@master
        with:
          container-name: itemsadder_server
          timeout: 60
